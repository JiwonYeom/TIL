# Open Source Analysis Series(1) - Laravel

### File Structure
- app : core code of application.
    - `console` and `Http` provides API into the core of app.
    - Use `make` Artisan command to generate classes here.
    - Jobs directory does not exist by default, but can be created with Artisan command. This is the queueable jobs house. 
    - Listeners directory does not exist by default. Contains classes that handles your events. Listeners receive an event instance, and perform logics. 
    - Mail directory can also be created by Artisan command. Contains all your email-related classes. 
    - Similarly, `Notifications`, `Policies`, `Providers`, and `Rules` directory are there to be created as needed.
- bootstrap : contains `app.php` file which bootstraps the framework. Houses a `cache` directory which contains cache files for optimized performances (generated)
- config : contains all of config files.
- database : contains database migration & seeds. Can also be used as SQLite database.
- public : contains `index.php` file. Also houses assets.
- resources : views + raw,un-compiled assets (LESS, SASS, js..) + all language files.
- routes : all route definitions. Default route files : `web.php`, `api.php`, `console.php`, `channels.php`
    - `web.php` : routes that `RouteServiceProivder` places in the `web` middleware group.
        - session state, CSRF protection, cookie encryption
        - If your app does not offer a stateless, RESTful API, most likely all routes will be here.
    - `api.php` : routes that `RouteServiceProvider` places in the `api` middleware group.
        - Intended to be stateless. Requests entering the app through these routes are intended to be authenticated via tokens.
        - It will also not have access to session state.
    - `console.php` : define Closure based console commands. 
    - `channels.php` " register all the event broadcasting channels
- storage : contains compiled Blade templates, file based sessions, file caches, other files generated. 
    - gets segregated into `app`, `framework`, `logs` directories.
    - user-generated files can be stored at `storage/app/public` direcotry. Make a symbolic link at `public/storage` that points to this directory. This can be done through `php artisan storage:link` command.
- tests
    - Automated tests using `PHPUnit`.Suffix each test class with `Test`. 
- Vendor
    - Composer dependencies

> Structure intended to provide good starting point for both large & small apps.
> No `models` directory, and placed in `app` directory by default but can be moved out if wanted by the developer.

### Environment
- Initially, there will be `.env.example` file but this will be renamed to `.env` when installed by composer. This file can be overriden by `.env.testing` file if you create it and run PHPUnit tests or execute Artisan commands with `--env=testing` option.
- All values in `.env` file can be retrieved with `$_ENV` superglobal or `env()` helper.
- Similarly, configs can be retrieved / changed during the runtime by `config()` helper.
- Configs can be cached with `config:cache` Artisan command. 
- 

### Architecture
- **Request lifecycle**
    1. Entry point for all requests to the app is `public/index.php` file. All requests are directed to this file by the webserver configuration.
    2. loads Composer generated autoloader definitions -> retrieves instance of Laravel application from `bootstrap/app.php` script.
    3. Laravel creates instance of the application / service container
    4. Requests are sent to HTTP kernel / cosole kernel. These two kernels are the central location that all requests flow through.
        - HTTP Kernel is at `app/Http/Kernel.php`.
        - HTTP Kernel extends class that defines some `bootstrappers` and list of HTTP middleware(handles HTTP session, determining maintenance mode, verify CSRF token..)
        - HTTP kernel's handle method receive a `Request` and return a `Response`
    5. Service provider's `register` method gets called on all providers. After that, `boot` method will be ccalled. Service providers bootstraps all the components(database, queue, validation and routing components)
    6. Dispatch Reuqest will dispatch the request to a route or controller or middleware.

- Service Container
    - Tool to manage class dependencies and perform dependency injection. 

- Service Provider

- Facade

- Contract

### Artisan
- Seemingly critical part in Laravel. Many parts of the app are generated by the Artisan commands. (Ex. custom console commands, events, classes..)

### Others
- `server.php`: emulate Apache's mod_rewrite functionality. Allows testing Laravel application without installing real web server.

- `phpunit.xml`: phpunit config file.

- `gitattributes`

++++
- PHP `$_SERVER`: contains information such as headers, paths, and script locations. 
